# Grafana Dashboard ConfigMaps for TestRails

apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-testrails
  namespace: testrails-prod
  labels:
    grafana_dashboard: "1"
data:
  testrails-overview.json: |
    {
      "dashboard": {
        "title": "TestRails Overview",
        "panels": [
          {
            "title": "Request Rate",
            "targets": [{
              "expr": "rate(http_requests_total[5m])",
              "legendFormat": "{{ method }} {{ path }}"
            }],
            "type": "graph"
          },
          {
            "title": "Error Rate",
            "targets": [{
              "expr": "rate(http_requests_total{status=~'5..'}[5m])",
              "legendFormat": "5xx Errors"
            }],
            "type": "graph"
          },
          {
            "title": "Response Time (p95)",
            "targets": [{
              "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
              "legendFormat": "p95"
            }],
            "type": "graph"
          },
          {
            "title": "Pod Status",
            "targets": [{
              "expr": "kube_pod_status_phase{namespace='testrails-prod'}",
              "legendFormat": "{{ phase }}"
            }],
            "type": "stat"
          },
          {
            "title": "Database Connections",
            "targets": [{
              "expr": "pg_stat_activity_count",
              "legendFormat": "Active Connections"
            }],
            "type": "gauge"
          },
          {
            "title": "CPU Usage",
            "targets": [{
              "expr": "rate(container_cpu_usage_seconds_total{namespace='testrails-prod'}[5m])",
              "legendFormat": "{{ pod }}"
            }],
            "type": "graph"
          },
          {
            "title": "Memory Usage",
            "targets": [{
              "expr": "container_memory_usage_bytes{namespace='testrails-prod'} / 1024 / 1024",
              "legendFormat": "{{ pod }}"
            }],
            "type": "graph"
          },
          {
            "title": "Redis Hit Rate",
            "targets": [{
              "expr": "rate(redis_keyspace_hits[5m]) / (rate(redis_keyspace_hits[5m]) + rate(redis_keyspace_misses[5m]))",
              "legendFormat": "Hit Rate"
            }],
            "type": "graph"
          }
        ]
      }
    }
